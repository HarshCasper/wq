wq Configuration Object
=======================

The wq Configuration object is a JSON structure that describes the [URL structure] of a website (/web app) *and* its corresponding REST API.  It assumes the website and the API share the same URL structure; see [My Website is its own REST API] for more on this approach.  The configuration object is typically generated by a REST service (e.g. [wq.db]) and provided to a JavaScript client (e.g. [wq.app]) in order to set common expectations on the layout of the application.

The basic format of the wq Configuration Object is:

```javascript
{
    'pages': {
        '[model_name]': {'list': true, 'url': '[model_name]s'},
        '[simple_page]': {'url': '[simple_page]'}
    }
}
```

The object is typically made available as `config.json` at the top level of the REST [URL structure].

> **Implementation Note**: If you are using [wq.db], a usable configuration object can be generated automatically by the default [router] based on your registered Django models.  The object can be generated on the command line via `./manage.py dump_config` if `wq.db.rest` is in your application's `INSTALLED_APPS`.  If you need to customize an entry in the wq.db-generated `pages` configuration, you should generally do so by supplying additional arguments to  `router.register_model` in [wq.db.rest] - otherwise the server and client configurations may be out of sync.  The information below is for those interested in fine-tuning the individual settings, and for those using [wq/app.js] without [wq.db].

## Configuration Options
The primary (and currently only) configuration section in the wq configuration object is `pages`, which contains detailed information about the [URL structure] of the application.  For example, the `pages` configuration is used by [wq/app.js] to map URL requests to page templates to render, and also to provide hints to [wq/store.js] as to the structure of the REST API containing the actual data.

As its name implies, the `pages` section summarizes all of the available "pages" in the application.  The section is a mapping of page "names" to simple configuration objects describing each respective page.  Pages fall into two categories depending on whether or not they are backed by a database table (i.e. ORM model in a Django application).

 * Pages backed by a database table are indicated with `"list": true`.  The name of these pages is the name of the underlying database model.  Marking a page as `"list": true` implies the presence of list, detail, and edit views for a database entity - all with [corresponding URLs] defined relative to the `url` property defined for the page.

 * Pages without a corresponding model do not have the `list` property set, and have only a single URL which is specified by the `url` property.  By convention, the name of these pages is usually the same as the URL.

The full listing of page configuration options is described below.

### General Options

 Name | Usage
------|-------
`list` | Boolean.  Sets whether or this is a *list* page or a *simple* page.  If true, it is assumed that there will be a set of [templates] named `[model_name]_list`, `[model_name]_detail`, and optionally `[model_name]_edit`.  If false or unset, it is assumed that there will be a single template with the same name as the page.
`url` | The URL of the page.  For simple pages, this is conventionally the same as the name of the page.  For list views, it is typically the verbose plural name of the model (without spaces).  The list view will be rendered at `[url]/`, while detail and edit views will be constructed from this value as `[url]/[item_id]` and `[url]/[item_id]/edit`, respectively.
`once` | Whether to only render this page once or every time it is opened during a browsing session.  The default is false (render every time), which is usually acceptable and is the recommended setting for list pages.  The primary use for this value is with simple pages such as overview maps. Setting `once` to true in this case means that the user can browse around the application then come back to the overview map and find it in the same position as when they left. This option only makes sense in a browser context that supports [PJAX-style] dynamic page loading (this includes most modern browsers).
`name` | The name of the page (copied from the `pages` key for convenience)

### Additional Options for Lists

 Name | Usage
------|-------
`parents` | A list of models that can be considered "parents" to this model.  Typically this means that this model contains a foreign key pointing to the parent model(s).  If the model contains more than one foreign key to the same parent model, `parents` should be a mapping of field names to parent models, e.g. `{"createdby": "user", "assignedto": "user"}`.
`children` | A list of models that can be considered "children" to this model.  Typically this means that the child model(s) contain foreign keys pointing to this model.
`map` | Whether or not this page includes a map (as implemented in the [wq/map.js] plugin).  wq.db will set this automatically on models that follow the [locate design pattern] or have a field named `latitude`, `longitude`, or `geometry`.  
`annotated`<br>`identified`<br>`located`<br>`related` | Boolean options, indicating that the model follows one or more of the [wq.db design patterns].
`can_add`<br>`can_edit`<br>`can_delete` | Flags indicating which permissions the current user has on the model.  This information can be computed and enforced by wq.db.  It is useful as a [template rendering context] variable for showing and hiding available options to the user.  It is not strictly enforced by wq/app.js since wq.db (or a compatible REST service) should be handling permissions on the server side.
`per_page` | Number of results to return per page in paginated lists by default.  Enforced by wq.db, but can be overridden by the `limit` url argument.
`lookup` | Name of identifier column to use when looking up objects for detail views, and to use as the `id` attribute in serialized JSON data.  Defaults to `obj.pk`, except for `identified` models where the default is `obj.primary_identifier.slug`.  Enforced by wq.db; mostly invisible to wq.app.
`partial` | Indicates that the REST service is filtering results from the list view JSON payload (typically to conserve localStorage usage).  If `partial` is set to false or unset, wq/app.js will immediately return a faux 404 page if the user attempts to navigate to the detail view of an object not found in the local store.  If `partial` is true, wq/app.js will instead attempt to request the detail view as HTML directly from the server and display it if successful.
`reversed` | Indicates that the REST service orders results in reverse order (e.g. newest to oldest).  Used by [wq/app.js] to append newly saved items to the beginning of the cached list.
`max_local_pages` | Used for pagination control, to set a limit on how many paginated pages of list JSON to load and store locally when searching for an individual item.  Typically used with the `partial` option.
`postsave` | The name of the page to return to after saving a record, with an optional "mode" extension.  Available modes are the same as the [templates]: `_list`, `_detail`, and `_edit`.  The default `postsave` action is to return to the detail view of the newly saved item (i.e. `[pagename]_detail`).  If `postsave` is set to a parent of the current page (i.e. `[parentpage]_detail`), the foreign key will be consulted to determine which parent object to show.  *(Support for mode added in wq.app 0.7.1)*
`choices` | A set of valid choices for enum-style fields on the model.  If set this should contain an object of the following form:
```javascript
{
   '[field_name]': [
       {'value':'[choice1_value]', 'label':'[choice1_label]'},
       {'value':'[choice2_value]', 'label':'[choice2_label]'}
       // ...
    ]
}
```
`choices` information is surfaced in the `[model_name]_edit` [template rendering context] as `[field_name]_choices`.

[My Website is its own REST API]: https://wq.io/docs/website-rest-api
[router]: https://wq.io/docs/router
[wq/app.js]: https://wq.io/docs/app-js
[wq/store.js]: https://wq.io/docs/store-js
[corresponding URLs]: https://wq.io/docs/url-structure
[URL structure]: https://wq.io/docs/url-structure
[wq.db]: https://wq.io/wq.db
[wq.app]: https://wq.io/wq.app
[wq.db.rest]: https://wq.io/docs/about-rest
[templates]: https://wq.io/docs/templates
[PJAX-style]: https://wq.io/docs/web-app
[wq.db design patterns]: https://wq.io/docs/about-patterns
[locate design pattern]: https://wq.io/docs/locate
[template rendering context]: https://wq.io/docs/templates
[wq/map.js]: https://wq.io/docs/map-js
